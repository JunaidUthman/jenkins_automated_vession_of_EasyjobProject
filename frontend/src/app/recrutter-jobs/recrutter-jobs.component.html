<!-- home.component.html -->
<div class="home-container">
  <div class="home-content">

    <!-- Page Header -->
    <div class="page-header">
      <h1>Create More Opportunities</h1>
      <p>Here you can create&find Your Jobs/Internships</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="action-container">
      <div class="tabs-container">
        <button class="tab-btn" [class.active]="activeTab === 'trending-jobs'" (click)="setActiveTab('trending-jobs')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z" />
          </svg>
          Trending Jobs
        </button>

        <button class="tab-btn" [class.active]="activeTab === 'trending-internships'"
          (click)="setActiveTab('trending-internships')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z" />
          </svg>
          Trending Internships
        </button>
      </div>

      <div>
        <button class="btn-post-job" (click)="openCreateJobForm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z" />
          </svg>
          Post a Job
        </button>
      </div>

      <!-- Create Job Form Modal -->
      <div *ngIf="showCreateJobForm" class="modal-overlay" (click)="closeCreateJobForm()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <button class="modal-close-btn" (click)="closeCreateJobForm()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
              stroke-width="2" viewBox="0 0 24 24">
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </button>
          <app-create-job-form [jobToUpdate]="selectedJobForUpdate" (close)="closeCreateJobForm()"
            (jobCreated)="onJobCreated()"></app-create-job-form>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
      <div class="delete-modal-content" (click)="$event.stopPropagation()">
        <button class="modal-close-btn" (click)="cancelDelete()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
            stroke-width="2" viewBox="0 0 24 24">
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
        <div class="delete-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" stroke="#ef4444" stroke-width="2"
            viewBox="0 0 24 24">
            <path
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        </div>
        <h3>Delete Job Posting?</h3>
        <p>This action cannot be undone. All applications associated with this job will also be removed.</p>
        <div class="delete-actions">
          <button class="btn-cancel" (click)="cancelDelete()">Cancel</button>
          <button class="btn-delete-confirm" (click)="confirmDelete()">Delete Forever</button>
        </div>
      </div>
    </div>


    <!-- Loading State -->
    <div *ngIf="isLoading()" class="spinner-container">
      <div class="spinner"></div>
      <p>Refreshing opportunities...</p>
    </div>

    <!-- Jobs List -->
    <div class="jobs-list" *ngIf="!isLoading()">
      <div class="job-card" *ngFor="let job of displayedJobs" (click)="closeMenu(job.id)">

        <!-- Header: Logo + Title/Company + Options Menu -->
        <div class="card-header">
          <div class="company-logo-container">
            <img *ngIf="job.logoUrl" [src]="job.logoUrl" alt="Company Logo">
            <svg *ngIf="!job.logoUrl" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#cbd5e1"
              viewBox="0 0 24 24">
              <path
                d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8V9h8v10zm-2-8h-4v2h4v-2zm0 4h-4v2h4v-2z" />
            </svg>
          </div>

          <div class="header-main-info">
            <h3 class="job-title">{{ job.title }}</h3>
            <p class="job-company">{{ job.company }}</p>
          </div>

          <div class="menu-container" (click)="$event.stopPropagation()">
            <button class="menu-btn" (click)="toggleMenu(job.id); $event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
              </svg>
            </button>
            <div class="dropdown-menu" *ngIf="showMenu[job.id]" (click)="$event.stopPropagation()">
              <button class="dropdown-item" (click)="updateJob(job.id)">Update</button>
              <button class="dropdown-item" (click)="deleteJob(job.id)">Delete</button>
            </div>
          </div>
        </div>

        <!-- Location & Time -->
        <div class="card-location-time">
          <div class="info-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
              stroke-width="2" viewBox="0 0 24 24">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            {{ job.location }}
          </div>
          <div class="info-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
              stroke-width="2" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 6v6l4 2" />
            </svg>
            {{ job.createdAt ? (job.createdAt | date:'mediumDate') : 'Just Now' }}
          </div>
        </div>

        <!-- Enums Badges -->
        <div class="card-badges">
          <span class="badge badge-contract">{{ job.contract_type }}</span>
          <span class="badge badge-education">{{ job.educationLevel }}</span>
        </div>

        <!-- Description Snippet -->
        <p class="card-description">{{ job.description }}</p>

        <!-- Action Buttons -->
        <div class="card-actions">
          <button class="btn-apply-full" (click)="$event.stopPropagation(); seeCandidates(job.id)">See
            Candidates</button>
          <button class="btn-view-details" (click)="$event.stopPropagation(); updateJob(job.id)">Edit Details</button>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="displayedJobs.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="#cbd5e1" viewBox="0 0 24 24">
          <path
            d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z" />
        </svg>
        <h3>No jobs found</h3>
        <p>Check back later for new opportunities</p>
      </div>
    </div>

  </div>
</div>